<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediQuick | Book Online Appointments</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

        :root {
            --blue: #0188df;
            --black: #444d53;
            --white: #fff;
        }

        * {
            font-family: "Roboto", sans-serif;
            margin: 0;
            padding: 0;
            text-decoration: none;
            outline: none;
            box-sizing: border-box;
            transition: all linear .2s;
        }

        html {
            font-size: 62.5%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        header {
            width: 96%;
            background: var(--white);
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translate(-50%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            z-index: 1000;
        }

        header a {
            color: var(--black);
        }

        header a:hover {
            color: var(--blue);
        }

        header .logo {
            font-size: 3rem;
        }

        header .logo span {
            color: var(--blue);
        }

        header .navbar ul {
            display: flex;
            align-items: center;
            justify-content: space-between;
            list-style: none;
        }

        header .navbar ul li {
            margin: 0 1rem;
        }

        header .navbar ul li a {
            font-size: 2rem;
            color: var(--black);
        }

        header .navbar ul li a:hover {
            color: var(--blue);
        }

        header .fa-bars {
            font-size: 3rem;
            color: var(--blue);
            cursor: pointer;
            display: none;
        }

        header .fa-times {
            transform: rotate(180deg);
        }

        .header-active {
            top: 0;
            width: 100%;
            box-shadow: .1rem .3rem rgba(0, 0, 0, .3);
        }

        .footer {
            background: var(--black);
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            padding: 2rem 0;
        }

        .footer .box {
            width: 30rem;
            margin: 2rem;
            text-align: center;
        }

        .footer .box:nth-child() {
            text-align: left;
        }

        .footer .box .logo {
            padding: 2rem 0;
            font-size: 3rem;
            color: var(--white);
        }

        .footer .box .logo:hover {
            color: var(--blue);
        }

        .footer .box .logo span {
            color: var(--blue);
        }

        .footer .box p {
            font-size: 1.5rem;
            color: var(--white);
        }

        .footer .box a {
            color: var(--white);
            font-size: 2rem;
            display: block;
            padding: .2rem 0;
        }

        .footer .box a:hover {
            text-decoration: underline;
        }

        .footer .credit {
            width: 85%;
            padding-top: 1rem;
            font-size: 2rem;
            color: var(--white);
            text-align: center;
            border-top: .2rem solid var(--white);
        }

        .footer .credit span {
            color: var(--blue);
            text-decoration: underline;
            letter-spacing: .5rem;
        }

        .search-doctor {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: var(--black);
            color: white;
            margin-top: 100px;
        }

        .search-bar {
            display: flex;
            gap: 10px;
        }

        .search-bar input,
        .filter-dropdown {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .button {
            padding: 10px 20px;
            border: none;
            background-color: var(--blue);
            color: var(--white);
            cursor: pointer;
            border-radius: 5px;
        }

        .heading {
            font-size: 2.5rem;
            color: var(--blue);
        }

        .button:hover {
            background-color: var(--blue);
        }

        .doctor-list {
            padding: 20px;
        }

        .scroll-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            font-size: 1.5rem;
        }

        .doctor-card {
            display: flex;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
        }

        .doctor-card img {
            width: 200px;
            border-radius: 10px;
            margin-right: 20px;
        }

        .book-now {
            background-color: var(--blue);
            padding: 10px;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .book-now:hover {
            background-color: var(--black);
        }

        .title {
            font-size: 2rem;
            color: var(--blue);
        }

        .online-badge {
            background-color: #4CAF50;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 1.2rem;
            margin-left: 10px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 2rem;
        }

        .error-message {
            color: red;
            text-align: center;
            padding: 20px;
            font-size: 1.8rem;
        }

        @media (max-width:768px) {
            html {
                font-size: 55%;
            }

            header .fa-bars {
                display: block;
            }

            header .navbar {
                position: fixed;
                top: -100rem;
                left: 0;
                width: 100%;
                background: var(--white);
                opacity: 0;
            }

            header .navbar ul {
                flex-flow: column;
                padding: 2rem 0;
            }

            header .navbar ul li {
                margin: 1rem 0;
                width: 100%;
                text-align: center;
            }

            header .navbar ul li a {
                font-size: 2rem;
                display: block;
            }

            header .nav-toggle {
                top: 5.5rem;
                opacity: 1;
            }

            .search-doctor {
                flex-flow: column;
            }

            .search-doctor .search-bar {
                flex-flow: column;
            }

            .doctor-card {
                flex-direction: column;
                text-align: center;
            }

            .doctor-card img {
                margin-right: 0;
                margin-bottom: 15px;
            }
        }
    </style>
</head>

<body>
    <header>
        <a href="#" class="logo"><span>M</span>edi<span>Q</span>uick</a>
        <nav class="navbar">
            <ul>
                <li><a href="/about">About Us</a></li>
                <li><a href="/faqs">FAQs</a></li>
                <li><a href="/blogs">Blog</a></li>
                <li><a href="/contact">Contact Us</a></li>
                <li><a href="/patient_profile"><img src="https://static.thenounproject.com/png/638636-200.png"
                            alt="Profile Image" height="30px" width="30px"></a></li>
            </ul>
        </nav>
        <div class="fas fa-bars"></div>
    </header>

    <section class="search-doctor">
        <h1 class="heading">Book Online Appointment</h1>
        <div class="search-bar">
            <input type="text" id="search" placeholder="Search doctors by name..." oninput="searchDoctorsByName()">
            <select id="specialization-filter" class="filter-dropdown" onchange="filterDoctors()">
                <option value="">All Specializations</option>
                <!-- Specializations will be populated dynamically -->
            </select>
            <button class="button" onclick="filterBySpecialization()">Search by Specialization</button>
        </div>
    </section>

    <section class="doctor-list">
        <h2 class="title">Available Doctors (Online)</h2><br>
        <div class="loading" id="loading">
            <i class="fas fa-spinner fa-spin"></i> Loading doctors...
        </div>
        <div class="error-message" id="error-message" style="display: none;"></div>
        <div class="scroll-container" id="doctor-container">
            <!-- Doctors will be loaded here dynamically -->
        </div>
    </section>

    <footer class="footer">
        <div class="box">
            <a href="#" class="logo"><span>M</span>edi<span>Q</span>uick</a>
            <p>Your trusted healthcare partner for quick and reliable medical services.</p>
        </div>
        <div class="box">
            <h3>Quick Links</h3>
            <a href="/">Home</a>
            <a href="/about">About Us</a>
            <a href="/faqs">FAQs</a>
            <a href="/blogs">Blog</a>
        </div>
        <div class="box">
            <h3>Contact Us</h3>
            <a href="#">+123-456-7890</a>
            <a href="#">support@mediquick.com</a>
            <a href="#">123 Health Street, Medical City</a>
        </div>
        <div class="credit">
            &copy; <span id="year"></span> by <span>MediQuick</span> | all rights reserved!
        </div>
    </footer>

    <!-- jquery cd link -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <script>
        // Global variable to store all doctors
        let allDoctors = [];
        let specializations = new Set();

        // Fetch doctors asynchronously
        async function fetchDoctors() {
            try {
                showLoading();
                const response = await fetch('/patient/api/doctors/online');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const doctors = await response.json();
                allDoctors = doctors;
                
                // Extract unique specializations
                specializations = new Set(doctors.map(doc => doc.specialization || 'General Physician'));
                
                // Populate specialization dropdown
                populateSpecializationFilter();
                
                // Render doctors
                renderDoctors(doctors);
                
                hideLoading();
            } catch (error) {
                console.error('Error fetching doctors:', error);
                showError('Failed to load doctors. Please try again later.');
                hideLoading();
            }
        }

        // Populate specialization filter dropdown
        function populateSpecializationFilter() {
            const filterDropdown = document.getElementById('specialization-filter');
            
            // Clear existing options except the first one
            while (filterDropdown.options.length > 1) {
                filterDropdown.remove(1);
            }
            
            // Add specializations to dropdown
            specializations.forEach(spec => {
                const option = document.createElement('option');
                option.value = spec;
                option.textContent = spec;
                filterDropdown.appendChild(option);
            });
        }

        // Render doctors to the container
        function renderDoctors(doctors) {
            const container = document.getElementById('doctor-container');
            container.innerHTML = '';
            
            if (doctors.length === 0) {
                container.innerHTML = '<div class="error-message">No doctors available at the moment.</div>';
                return;
            }
            
            doctors.forEach(doctor => {
                const doctorCard = document.createElement('div');
                doctorCard.className = 'doctor-card';
                doctorCard.setAttribute('data-name', doctor.name);
                doctorCard.setAttribute('data-specialization', doctor.specialization || 'General Physician');
                
                doctorCard.innerHTML = `
                    <img src="https://icons.veryicon.com/png/o/healthcate-medical/orange-particle/doctor-20.png" alt="Doctor Image">
                    <div>
                        <h3>Dr. ${doctor.name} <span class="online-badge">Online</span></h3>
                        <p>Specialist: ${doctor.specialization || 'General Physician'}</p>
                        <p>Email: ${doctor.email}</p>
                        <p>Available: ${doctor.availability || '9:00 AM - 5:00 PM'}</p>
                        <p>Experience: ${doctor.experience || '5+ years'}</p>
                        <a href="/patient/doctor-profile-patient/${doctor.id}"><button class="book-now">Consult Now</button></a>
                    </div>
                `;
                
                container.appendChild(doctorCard);
            });
        }

        // Search doctors by name
        function searchDoctorsByName() {
            const searchQuery = document.getElementById('search').value.toLowerCase();
            const filteredDoctors = allDoctors.filter(doctor => 
                doctor.name.toLowerCase().includes(searchQuery)
            );
            renderDoctors(filteredDoctors);
        }

        // Filter doctors by specialization
        function filterDoctors() {
            const specializationFilter = document.getElementById('specialization-filter').value;
            
            if (!specializationFilter) {
                renderDoctors(allDoctors);
                return;
            }
            
            const filteredDoctors = allDoctors.filter(doctor => 
                (doctor.specialization || 'General Physician') === specializationFilter
            );
            renderDoctors(filteredDoctors);
        }

        function filterBySpecialization() {
            filterDoctors(); // Same functionality
        }

        // UI helper functions
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error-message').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Set current year in footer
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // Fetch doctors
            fetchDoctors();
            
            // Set up navbar toggle
            $('.fa-bars').click(function () {
                $(this).toggleClass('fa-times');
                $('.navbar').toggleClass('nav-toggle');
            });
            
            $(window).on('scroll load', function () {
                $(this).removeClass('fa-times');
                $('.navbar').removeClass('nav-toggle');
                if ($(window).scrollTop() > 30) {
                    $('header').addClass('header-active');
                } else {
                    $('header').removeClass('header-active');
                }
            });
        });
    </script>
</body>
</html>