<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/css/bookAppointment.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap');

        :root {
            --blue: #0188df;
            --black: #444d53;
            --white: #fff;
        }

        * {
            font-family: "Roboto", sans-serif;
            margin: 0;
            padding: 0;
            text-decoration: none;
            outline: none;
            box-sizing: border-box;
            transition: all linear .2s;
        }

        html {
            font-size: 62.5%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        header {
            width: 96%;
            background: var(--white);
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translate(-50%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
            z-index: 1000;
        }

        header a {
            color: var(--black);
        }

        header a:hover {
            color: var(--blue);
        }

        header .logo {
            font-size: 3rem;
        }

        header .logo span {
            color: var(--blue);
        }

        header .navbar ul {
            display: flex;
            align-items: center;
            justify-content: space-between;
            list-style: none;
        }

        header .navbar ul li {
            margin: 0 1rem;
        }

        header .navbar ul li a {
            font-size: 2rem;
            color: var(--black);
        }

        header .navbar ul li a:hover {
            color: var(--blue);
        }

        header .fa-bars {
            font-size: 3rem;
            color: var(--blue);
            cursor: pointer;
            display: none;
        }

        header .fa-times {
            transform: rotate(180deg);
        }

        .header-active {
            top: 0;
            width: 100%;
            box-shadow: .1rem .3rem rgba(0, 0, 0, .3);
        }

        .footer {
            background: var(--black);
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            padding: 2rem 0;
        }

        .footer .box {
            width: 30rem;
            margin: 2rem;
            text-align: center;
        }

        .footer .box:nth-child() {
            text-align: left;
        }

        .footer .box .logo {
            padding: 2rem 0;
            font-size: 3rem;
            color: var(--white);
        }

        .footer .box .logo:hover {
            color: var(--blue);
        }

        .footer .box .logo span {
            color: var(--blue);
        }

        .footer .box p {
            font-size: 1.5rem;
            color: var(--white);
        }

        .footer .box a {
            color: var(--white);
            font-size: 2rem;
            display: block;
            padding: .2rem 0;
        }

        .footer .box a:hover {
            text-decoration: underline;
        }

        .footer .credit {
            width: 85%;
            padding-top: 1rem;
            font-size: 2rem;
            color: var(--white);
            text-align: center;
            border-top: .2rem solid var(--white);
        }

        .footer .credit span {
            color: var(--blue);
            text-decoration: underline;
            letter-spacing: .5rem;
        }

        .search-doctor {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background-color: var(--black);
            color: white;
            margin-top: 100px;
        }

        .search-bar {
            display: flex;
            gap: 10px;
        }

        .search-bar input,
        .filter-dropdown {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .button {
            padding: 10px 20px;
            border: none;
            background-color: var(--blue);
            color: var(--white);
            cursor: pointer;
            border-radius: 5px;
        }

        .heading {
            font-size: 2.5rem;
            color: var(--blue);
        }

        .button:hover {
            background-color: var(--blue);
        }

        .doctor-list {
            padding: 20px;
        }

        .scroll-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            font-size: 1.5rem;
        }

        .doctor-card {
            display: flex;
            align-items: center;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
        }

        .doctor-card img {
            width: 200px;
            border-radius: 10px;
            margin-right: 20px;
        }

        .book-now {
            background-color: var(--blue);
            padding: 10px;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .book-now:hover {
            background-color: var(--black);
        }

        .title {
            font-size: 2rem;
            color: var(--blue);
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: var(--blue);
        }

        .error-message {
            text-align: center;
            padding: 20px;
            color: red;
            font-size: 16px;
        }

        @media (max-width:768px) {
            html {
                font-size: 55%;
            }

            header .fa-bars {
                display: block;
            }

            header .navbar {
                position: fixed;
                top: -100rem;
                left: 0;
                width: 100%;
                background: var(--white);
                opacity: 0;
            }

            header .navbar ul {
                flex-flow: column;
                padding: 2rem 0;
            }

            header .navbar ul li {
                margin: 1rem 0;
                width: 100%;
                text-align: center;
            }

            header .navbar ul li a {
                font-size: 2rem;
                display: block;
            }

            header .nav-toggle {
                top: 5.5rem;
                opacity: 1;
            }

            .search-doctor {
                flex-flow: column;
            }

            .search-doctor .search-bar {
                flex-flow: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="#" class="logo"><span>M</span>edi<span>Q</span>uick</a>
        <nav class="navbar">
            <ul>
                <li><a href="/about">About Us</a></li>
                <li><a href="/faqs">FAQs</a></li>
                <li><a href="/blogs">Blog</a></li>
                <li><a href="/contact">Contact Us</a></li>
                <li><a href="/patient-profile"><img
                            src="https://static.thenounproject.com/png/638636-200.png"
                            alt="Profile Image" height="30px" width="30px"></a></li>
            </ul>
        </nav>
        <div class="fas fa-bars"></div>
    </header>

    <section class="search-doctor">
        <h1 class="heading">Book an Offline Appointment</h1>
        <div class="search-bar">
            <input type="text" id="search" placeholder="Search doctors by name..." oninput="searchDoctorsByName()">
            <select id="specialization-filter" class="filter-dropdown" onchange="filterDoctors()">
                <option value="">All Specializations</option>
                <!-- Options will be populated dynamically via AJAX -->
            </select>
            <select id="location-filter" class="filter-dropdown" onchange="filterDoctors()">
                <option value="">All Locations</option>
                <!-- Options will be populated dynamically via AJAX -->
            </select>
        </div>
    </section>

    <section class="doctor-list">
        <h2 class="title">Available Doctors</h2><br>
        <div class="scroll-container" id="doctor-container">
            <div class="loading" id="loading">
                <i class="fas fa-spinner fa-spin"></i> Loading doctors...
            </div>
            <!-- Doctors will be populated dynamically via AJAX -->
        </div>
    </section>

    <%- include('partials/footer') %>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        // Global variable to store all doctors
        let allDoctors = [];

        $(document).ready(function () {
            $('.fa-bars').click(function () {
                $(this).toggleClass('fa-times');
                $('.navbar').toggleClass('nav-toggle');
            });
            
            $(window).on('scroll load', function () {
                $(this).removeClass('fa-times');
                $('.navbar').removeClass('nav-toggle');
                if ($(window).scrollTop() > 30) {
                    $('header').addClass('header-active');
                } else {
                    $('header').removeClass('header-active');
                }
            });

            // Load doctors asynchronously
            loadDoctors();
        });

        // Function to load doctors via AJAX
        function loadDoctors() {
            $.ajax({
                url: '/patient/api/doctors/offline',
                method: 'GET',
                dataType: 'json',
                success: function(doctors) {
                    allDoctors = doctors;
                    renderDoctors(doctors);
                    populateFilterOptions(doctors);
                    $('#loading').hide();
                },
                error: function(xhr, status, error) {
                    $('#loading').html('<div class="error-message">Error loading doctors. Please try again later.</div>');
                    console.error('Error fetching doctors:', error);
                }
            });
        }

        // Function to render doctors in the container
        function renderDoctors(doctors) {
            const container = $('#doctor-container');
            container.empty();
            
            if (doctors.length === 0) {
                container.html('<div class="no-doctors"><p>No doctors available at the moment. Please check back later.</p></div>');
                return;
            }
            
            doctors.forEach(doctor => {
                const doctorCard = `
                    <div class="doctor-card" data-name="${doctor.name}" data-location="${doctor.location}" data-specialization="${doctor.specialization}">
                        <img src="https://icons.veryicon.com/png/o/healthcate-medical/orange-particle/doctor-20.png" alt="Doctor Image">
                        <div>
                            <h3>${doctor.name}</h3>
                            <p>Specialist: ${doctor.specialization}</p>
                            <p>Location: ${doctor.location}</p>
                            <p>Email: ${doctor.email}</p>
                            <p>Available: ${doctor.availability}</p>
                            <a href="/patient/doctor-profile-patient/${doctor.id}">
                                <button class="book-now">Book Now</button>
                            </a>
                        </div>
                    </div>
                `;
                container.append(doctorCard);
            });
        }

        // Function to populate filter dropdowns
        function populateFilterOptions(doctors) {
            const specializations = [...new Set(doctors.map(doc => doc.specialization))];
            const locations = [...new Set(doctors.map(doc => doc.location))];
            
            const specializationFilter = $('#specialization-filter');
            const locationFilter = $('#location-filter');
            
            // Add specialization options
            specializations.forEach(spec => {
                if (spec) {
                    specializationFilter.append(`<option value="${spec}">${spec}</option>`);
                }
            });
            
            // Add location options
            locations.forEach(location => {
                if (location) {
                    locationFilter.append(`<option value="${location}">${location}</option>`);
                }
            });
        }

        // Search function
        function searchDoctorsByName() {
            let searchQuery = $('#search').val().toLowerCase();
            let filteredDoctors = allDoctors;
            
            if (searchQuery) {
                filteredDoctors = allDoctors.filter(doctor => 
                    doctor.name.toLowerCase().includes(searchQuery)
                );
            }
            
            renderDoctors(filteredDoctors);
        }

        // Filter function
        function filterDoctors() {
            let specializationFilter = $('#specialization-filter').val();
            let locationFilter = $('#location-filter').val().toLowerCase();
            let searchQuery = $('#search').val().toLowerCase();
            
            let filteredDoctors = allDoctors;
            
            // Apply specialization filter
            if (specializationFilter) {
                filteredDoctors = filteredDoctors.filter(doctor => 
                    doctor.specialization === specializationFilter
                );
            }
            
            // Apply location filter
            if (locationFilter) {
                filteredDoctors = filteredDoctors.filter(doctor => 
                    doctor.location.toLowerCase().includes(locationFilter)
                );
            }
            
            // Apply search filter
            if (searchQuery) {
                filteredDoctors = filteredDoctors.filter(doctor => 
                    doctor.name.toLowerCase().includes(searchQuery)
                );
            }
            
            renderDoctors(filteredDoctors);
        }
    </script>
</body>
</html>